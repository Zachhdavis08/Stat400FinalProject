---
title: "Stat 400 Final Project"
author: "Zachary Davis"
date: "2024-04-05"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

covid death

```{r}
library(tidyverse)
library(ggplot2)
library(dplyr)
```

```{r}
covidData <- read.csv("/Users/griffinconaway/Documents/covid_international2022.csv", header = TRUE, sep = ",")
covidData <- read.csv("C://Users//zachh//Data//covid_international.csv")
```

(^temporary file directory)

```{r}
covidData2 <- covidData %>% 
  drop_na(cases, deaths, population, pop_density, median_age, life_expectancy, pct_over_65, gdp_pc, pct_extreme_poverty, bci_bci)
```

This chunk of code is meant to remove all cases that have an N/A value in the columns specified.  I included the response variable "deaths" as well as the predictor variables we deemed to be most relevant, which were as follows:

Population, population density, median age, life expectancy, percentage of the population over the age of 65, national gdp weighted by population, and percentage of the population living in extreme poverty.  

I also added the bci_bci variable solely to get rid of the case "World" so that it would not influence our data.

It is important that we remove the cases that have an N/A value for one of these variables, because these are the variables we are most likely to use in our models.  At the same time, we need to make sure that we don't include too many variables because we don't want to reduce our number of cases too far to the point where our data frame is too small. 

```{r}
glimpse(covidData)
glimpse(covidData2)
```

As shown above, by removing the cases that had an N/A in the above columns, we went from 244 cases to 122 cases.  To ensure that we still have a representative distribution of countries, I wanted to compare to the distribution of some of the variables between the original and cleaned data frames.

```{r}
covidData %>% count(continent)
covidData2 %>% count(continent)
```

The cleaned data frame still contains a reasonable distribution of countries among the different continents.  Africa, Europe and Asia remain the most represented continents although there are still cases in every group.  Oceania going from 23 to 5 cases is a sizeable jump, however these are the countries likely to be the outliers in the data anyway.  We will now check some other distributions among the two data sets.

```{r}
hist(covidData$life_expectancy, data = covidData)
hist(covidData2$life_expectancy, data = covidData2)
```

Here are the distributions for life expectancy for the two data frames.  Both distributions are generally skewed left and peak at the 75-80 category.  There is a bit of variation in the cleaned data set with the 60-65 range being high by comparison, but overall these distributions are similar enough.

```{r}
hist(covidData$pop_density, breaks = 20, data = covidData)
hist(covidData2$pop_density, breaks = 20, data = covidData2)

hist(covidData$median_age, data = covidData)
hist(covidData2$median_age, data = covidData2)

hist(covidData$pct_over_65, data = covidData)
hist(covidData2$pct_over_65, data = covidData2)
```

Here are the distributions of some of the other variables we deemed to be relevant.  Again, the distributions appear to be similar between the two data frames.  Based on this information, we will move ahead with the cleaned data set.   

```{r}
head(covidData)
head(covidData2)
```

Here are the first six cases of both the original and cleaned data set.  It can be seen that a few of the values displayed here for the original data set are not contained within the cleaned set.  One such value that appears above is "Africa".  In the original data set, all of the continents were included as well as other subsets of the global population such as "High Income".  These were among the 13 cases in the original data set that were not prescribed to a continent themselves.  In the revised data set, all of these cases have been removed.

Now that we have the data set that we want, we want to look at the relationship between our response variable "deaths" and other singular explanatory variables.  As a test for our data set, we will look at the relationship between "cases" (covid cases) and "deaths" by case (country).  

```{r}
covidModel <- lm(deaths ~ cases, data = covidData2)
summary(covidModel)
```

Key Statistics:

p-value: 2.2e-16
F-statistic: 647.2
Multiple R-squared: 0.8436

The first two values here show us that there is a statistically significant relationship between "cases" and "deaths" as there should be.  With a Multiple R-squared of 0.8436, we also know that about 84.36% of the variance in the "deaths" variable is explained by the "cases" variable.  


Multi-Level EDA?:

```{r}
continent_summary <- covidData2 %>%
  group_by(continent) %>%
  summarise(
    total_deaths = sum(deaths, na.rm = TRUE),
    avg_cases = mean(cases, na.rm = TRUE),
    avg_pop_density = mean(pop_density, na.rm = TRUE),
    avg_life_expectancy = mean(life_expectancy, na.rm = TRUE),
    .groups = 'drop'
  )

print(continent_summary)
```

Here is a small summary of continents summarized by total covid deaths, covid cases, population density, and life expectancy. Our data comes with multiple levels, simply as countries are all nested in a continent, which contributes to our levels for our EDA.

```{r}
ggplot(covidData2, aes(x = continent, y = deaths, fill = continent)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "COVID-19 Deaths Distribution by Continent")
```

This visualization is a side-by-side boxplot showing Covid19 deaths per country grouped by continent. As we can see, there are many outliers in each continent, most likely representing the countries with the highest populations and population density per continent. The major outlier here appears to be the United States, as it has over 1,000,000 covid deaths, with the second closest point being in South America, most likely Brazil. Also, we can see that the countries grouped in South America have the highest median, as well as the highest IQR compared to the other 5 continents.

```{r}
ggplot(covidData2, aes(x = cases, y = deaths)) +
  geom_point(aes(color = continent)) +
  geom_smooth(method = "lm", se = FALSE) +
  theme_minimal() +
  labs(title = "COVID-19 Deaths vs Cases by Continent")
```

This scatterplot shows the relationship between Covid-19 deaths (y-axis) and the predictor total cases (x-axis) when countries are grouped into their respective continents. The scatterplot is also fitted with a best fit line that shows an approximate slope based on the data we have. As we can see there is a general positive relationship between deaths and cases, as cases increase, so does the amount of deaths. There does not appear to be any unusual points, however, we can see a North American point, the United States, has a lot more cases and deaths than the rest of the countries. We also can see the majority of points are towards the bottom right of the graph, meaning they have smaller totals in both cases and deaths. We can use this to show how population size could have a significant effect on the amount of covid deaths.

```{r}
ggplot(covidData2, aes(x = gdp_pc, y = deaths)) +
  geom_point(aes(color = hospital_beds_per_thousand)) +
  geom_smooth(method = "lm", se = FALSE) +
  scale_color_gradient(low = "blue", high = "red") +
  theme_minimal() +
  labs(title = "Deaths vs GDP per Capita (Colored by Hospital Beds per Thousand)")
```

This scatterplot shows the relationship of GDP weighted by population with the amount of deaths from covid. Futhermore, we can hospital beds per thousand related to the gdp predictor and the deaths. The fitted line is fit using a linear model of the predictors and the response.

```{r}
grouped_analysis <- covidData2 %>%
  group_by(continent) %>%
  summarise(
    median_deaths = median(deaths, na.rm = TRUE),
    correlation = cor(cases, deaths, use = "complete.obs"),
    avg_responsegrade = mean(as.numeric(response), na.rm = TRUE),
    .groups = 'drop'
  )

# View results
print(grouped_analysis)
```

This analysis shows countries grouped by continent, along with their median deaths, average response grade, as well as the correlation between the two. This helps us have insight on how each continent reacted to the virus on average, and how their deaths correlate to the response grade.
